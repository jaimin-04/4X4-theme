(()=>{var C={onLoad:function(){let{container:e}=this;this.elms={cartTotalMoney:e.querySelector(".js-cart-total-money"),cartTotalItem:e.querySelector(".js-cart-total-item"),cartItemTemplate:e.querySelector(".js-cart-item.template"),cartListContainer:e.querySelector(".js-cart-list"),cartForm:e.querySelector(".js-cart-form")},this.initUpsellSlider(),this.initEventCartItemList(),document.addEvent("product-added",({detail:n})=>this.updateLayout(n,"add")),this.initShoppingCalculator()},initEventCartItemList:function(){let{container:e}=this;e.getElementsByClassName("js-cart-item").forEach(a=>this.initEventCartItem(a))},initUpsellSlider:function(){let{container:e}=this,n=e.querySelector(".js-slider-container");if(!n)return;let a=JSON.parse(n.querySelector("[data-tns-config]").innerHTML);a.onInit=()=>{n.addClass("slider-initialized")},tns(a)},initEventCartItem:function(e){let{key:n}=e.dataset,a=e.querySelector(".js-btn-remove"),o=e.querySelector(".js-quantity-container"),r=o.querySelector("input"),t=e.querySelector(".js-line-item-total-money");AT.initInputQuantity(o),a.addEvent("click",i=>{i.preventDefault(),a.addClass("pending"),Cart.remove(n).then(s=>{e.remove(),this.updateLayout(s,"remove")})}),r.addEvent("change",AT.debounce(i=>{if(i.limitReached&&r.dataset.itemAdded==r.max){SendMessage.open(theme.strings.cart.lineItemMax);return}Cart.change(n,r.value).then(s=>{let d=s.items.find(u=>u.key===n);this.updateItemTotalMoney(t,d.final_line_price),r.setAttribute("data-item-added",d.quantity),this.updateLayout(s,"change")})},300))},updateLayout:function(e,n){let{cartTotalItem:a,cartItemTemplate:o,cartListContainer:r}=this.elms,t;switch(document.dispatchEvent(new CustomEvent("cart-change")),n){case"remove":e.item_count===0&&this.container.addClass("empty"),this.updateTotalMoney(e.total_price),a.innerHTML=e.item_count;break;case"change":this.updateTotalMoney(e.total_price),a.innerHTML=e.item_count;break;case"add":(t=[...r.children].find(i=>i.dataset.key===e.key))||(t=o.cloneNode(!0),t.setAttribute("key",e.key),t.querySelector(".js-name").innerHTML=`<strong>${e.product_title}</strong>`,t.querySelectorAll(".js-url").forEach(i=>i.href=e.url),t.querySelector(".js-img").src=e.image,t.querySelector(".js-price").innerHTML=e.final_price.toCurrency(),t.querySelector(".js-options").innerHTML=e.options_with_values.reduce((i,s)=>(i+=`<p class="option">${s.name}: ${s.value}</p>`,i),""),this.initEventCartItem(t),t.removeClass("template","d-none"),r.prepend(t)),t.querySelector(".js-input-quantity").value=e.quantity,this.updateItemTotalMoney(t.querySelector(".js-line-item-total-money"),e.final_line_price);break;default:break}},initShoppingCalculator(){let e=document.getElementById("shipping-calculator");if(!e)return;let n=e.querySelector(".shipping-calculator_form"),a=e.querySelector(".js-btn-submit-shipping"),o=e.querySelector("[name='address[country]']"),r=e.querySelector("[name='address[province]']"),t=e.querySelector("[name='address[zip]']"),i=e.querySelector(".js-shipping-calculator-results"),s=i.querySelector(".title"),d=i.querySelector("ul"),u=!1,S=l=>{let c=l.target.value;Countries[c].provinces?(r.innerHTML=Countries[c].provinces.map(m=>`<option value="${m}">${m}</option>`).join(""),u=!0,r.removeClass("d-none")):(r.addClass("d-none"),u=!1)};o.addEvent("change",S),document.addEvent("Countries loaded",()=>o.dispatchEvent(new Event("change"))),a.addEvent("click",()=>{if(o.value==="---"){SendMessage.open(theme.strings.shipping.missingCountry);return}if(u&&r.value==="placeholder-province"){SendMessage.open(theme.strings.shipping.missingProvince);return}if(!t.value){SendMessage.open(theme.strings.shipping.missingZip);return}i.style.height="",fetch(`/cart/shipping_rates.json?${["shipping_address[country]="+o.value,u&&"shipping_address[province]="+r.value,"shipping_address[zip]="+t.value].filter(Boolean).join("&")}`,{dataType:"json"}).then(l=>{let{length:c}=l.shipping_rates;s.innerHTML="",c===0?s.innerHTML=theme.strings.shipping.notResult:c===1?s.innerHTML=theme.strings.shipping.oneResult.replace("{{address}}",[t.value,r.value,o.value].filter(Boolean).join(", ")):s.innerHTML=theme.strings.shipping.manyResults.replace("{{address}}",[t.value,r.value,o.value].filter(Boolean).join(", ")).replace("{{results_total}}",l.shipping_rates.length).replace("{{rate_first}}",`<span class="js-money">${(l.shipping_rates[0].price*100).toCurrency()}</span>`),d.innerHTML="",c!=0&&(d.innerHTML=l.shipping_rates.map(m=>{let h=document.createElement("li");return h.innerHTML=theme.strings.shipping.resultItem.replace("{{name}}",m.name).replace("{{price}}",`<span class="js-money">${(m.price*100).toCurrency()}</span>`),h.outerHTML}).join("")),typeof Currencies!="undefined"&&d.getElementsByClassName("js-money").forEach(Currencies.registerObserve.bind(Currencies)),i.style.height=i.firstElementChild.offsetHeight+"px"}).catch(l=>{console.log(l),s.innerHTML="",d.innerHTML=Object.keys(l).map(c=>`<li>${c}: ${l[c]}</li>`),i.style.height=i.firstElementChild.offsetHeight+"px"})})},updateItemTotalMoney(e,n){typeof Currencies=="undefined"?e.innerHTML=n.toCurrency():e.setAttribute("data-money",n)},updateTotalMoney(e){let{cartTotalMoney:n}=this.elms;typeof Currencies=="undefined"?n.innerHTML=e.toCurrency():n.setAttribute("data-money",e)}};(()=>{register("cart-page",C),load("*")})();})();
