{
  "version": 3,
  "sources": ["../../app/scripts/common/section/section-cart-page.js", "../../app/scripts/cart-page.js"],
  "sourcesContent": ["export let CartPage = {\r\n  onLoad: function () {\r\n    let { container } = this;\r\n    this.elms = {\r\n      cartTotalMoney: container.querySelector(\".js-cart-total-money\"),\r\n      cartTotalItem: container.querySelector(\".js-cart-total-item\"),\r\n      cartItemTemplate: container.querySelector(\".js-cart-item.template\"),\r\n      cartListContainer: container.querySelector(\".js-cart-list\"),\r\n      // btnUpdate: container.querySelector(\".js-btn-update\"),\r\n      cartForm: container.querySelector(\".js-cart-form\"),\r\n    };\r\n    this.initUpsellSlider();\r\n    this.initEventCartItemList();\r\n    document.addEvent(\"product-added\", ({ detail: product }) => this.updateLayout(product, \"add\"));\r\n    this.initShoppingCalculator();\r\n  },\r\n\r\n  initEventCartItemList: function () {\r\n    let { container } = this;\r\n    let cartItemList = container.getElementsByClassName(\"js-cart-item\");\r\n\r\n    cartItemList.forEach((cartItem) => this.initEventCartItem(cartItem));\r\n  },\r\n\r\n  initUpsellSlider: function () {\r\n    let { container } = this;\r\n    let sliderContainer = container.querySelector(\".js-slider-container\");\r\n    if (!sliderContainer) {\r\n      return;\r\n    }\r\n    let config = JSON.parse(sliderContainer.querySelector(\"[data-tns-config]\").innerHTML);\r\n    config.onInit = () => {\r\n      sliderContainer.addClass(\"slider-initialized\");\r\n    };\r\n    tns(config);\r\n  },\r\n\r\n  initEventCartItem: function (cartItem) {\r\n    // let { btnUpdate } = this.elms;\r\n    let { key } = cartItem.dataset;\r\n    let btnRemove = cartItem.querySelector(\".js-btn-remove\");\r\n    let inputContainer = cartItem.querySelector(\".js-quantity-container\");\r\n    let input = inputContainer.querySelector(\"input\");\r\n    let cartItemTotalMoney = cartItem.querySelector(\".js-line-item-total-money\");\r\n\r\n    AT.initInputQuantity(inputContainer);\r\n    btnRemove.addEvent(\"click\", (e) => {\r\n      e.preventDefault();\r\n      btnRemove.addClass(\"pending\");\r\n      Cart.remove(key).then((data) => {\r\n        cartItem.remove();\r\n        this.updateLayout(data, \"remove\");\r\n      });\r\n    });\r\n\r\n    input.addEvent(\r\n      \"change\",\r\n      AT.debounce((e) => {\r\n        if (e.limitReached && input.dataset.itemAdded == input.max) {\r\n          SendMessage.open(theme.strings.cart.lineItemMax);\r\n          return;\r\n        }\r\n        Cart.change(key, input.value).then((data) => {\r\n          let dataItem = data.items.find((item) => item.key === key);\r\n          this.updateItemTotalMoney(cartItemTotalMoney, dataItem.final_line_price);\r\n          input.setAttribute(\"data-item-added\", dataItem.quantity);\r\n          // cartItemTotalMoney.innerHTML = dataItem.final_line_price.toCurrency();\r\n          // btnUpdate.removeClass(\"pending\");\r\n          // btnUpdate.disabled = false;\r\n          this.updateLayout(data, \"change\");\r\n        });\r\n      }, 300),\r\n    );\r\n  },\r\n\r\n  updateLayout: function (data, action) {\r\n    let { cartTotalItem, cartItemTemplate, cartListContainer } = this.elms;\r\n    let cartItem;\r\n    document.dispatchEvent(new CustomEvent(\"cart-change\"));\r\n    switch (action) {\r\n      case \"remove\":\r\n        if (data.item_count === 0) {\r\n          this.container.addClass(\"empty\");\r\n        }\r\n        this.updateTotalMoney(data.total_price);\r\n        cartTotalItem.innerHTML = data.item_count;\r\n        break;\r\n      case \"change\":\r\n        this.updateTotalMoney(data.total_price);\r\n        cartTotalItem.innerHTML = data.item_count;\r\n        break;\r\n      case \"add\":\r\n        if (!(cartItem = [...cartListContainer.children].find((item) => item.dataset.key === data.key))) {\r\n          cartItem = cartItemTemplate.cloneNode(true);\r\n          cartItem.setAttribute(\"key\", data.key);\r\n          cartItem.querySelector(\".js-name\").innerHTML = `<strong>${data.product_title}</strong>`;\r\n          cartItem.querySelectorAll(\".js-url\").forEach((item) => (item.href = data.url));\r\n          cartItem.querySelector(\".js-img\").src = data.image;\r\n          cartItem.querySelector(\".js-price\").innerHTML = data.final_price.toCurrency();\r\n          cartItem.querySelector(\".js-options\").innerHTML = data.options_with_values.reduce((accu, option) => {\r\n            accu += `<p class=\"option\">${option.name}: ${option.value}</p>`;\r\n            return accu;\r\n          }, \"\");\r\n          this.initEventCartItem(cartItem);\r\n          cartItem.removeClass(\"template\", \"d-none\");\r\n          cartListContainer.prepend(cartItem);\r\n        }\r\n\r\n        cartItem.querySelector(\".js-input-quantity\").value = data.quantity;\r\n        this.updateItemTotalMoney(cartItem.querySelector(\".js-line-item-total-money\"), data.final_line_price);\r\n\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  initShoppingCalculator() {\r\n    let container = document.getElementById(\"shipping-calculator\");\r\n    if (!container) {\r\n      return;\r\n    }\r\n    let shippingForm = container.querySelector(\".shipping-calculator_form\");\r\n    let btnSubmit = container.querySelector(\".js-btn-submit-shipping\");\r\n    let countryField = container.querySelector(\"[name='address[country]']\");\r\n    let provinceField = container.querySelector(\"[name='address[province]']\");\r\n    let zipField = container.querySelector(\"[name='address[zip]']\");\r\n    let shippingResults = container.querySelector(\".js-shipping-calculator-results\");\r\n    let shippingResultsTitle = shippingResults.querySelector(\".title\");\r\n    let shippingResultsList = shippingResults.querySelector(\"ul\");\r\n    let hasProvince = false;\r\n    const handleCountriesChange = (e) => {\r\n      let value = e.target.value;\r\n      if (Countries[value].provinces) {\r\n        provinceField.innerHTML = Countries[value].provinces\r\n          .map((province) => {\r\n            return `<option value=\"${province}\">${province}</option>`;\r\n          })\r\n          .join(\"\");\r\n        hasProvince = true;\r\n        provinceField.removeClass(\"d-none\");\r\n      } else {\r\n        provinceField.addClass(\"d-none\");\r\n        hasProvince = false;\r\n      }\r\n    };\r\n\r\n    countryField.addEvent(\"change\", handleCountriesChange);\r\n    document.addEvent(\"Countries loaded\", () => countryField.dispatchEvent(new Event(\"change\")));\r\n\r\n    btnSubmit.addEvent(\"click\", () => {\r\n      if (countryField.value === \"---\") {\r\n        SendMessage.open(theme.strings.shipping.missingCountry);\r\n        return;\r\n      }\r\n      if (hasProvince && provinceField.value === \"placeholder-province\") {\r\n        SendMessage.open(theme.strings.shipping.missingProvince);\r\n        return;\r\n      }\r\n      if (!zipField.value) {\r\n        SendMessage.open(theme.strings.shipping.missingZip);\r\n        return;\r\n      }\r\n      shippingResults.style.height = \"\";\r\n\r\n      fetch(\r\n        `/cart/shipping_rates.json?${[\r\n          \"shipping_address[country]=\" + countryField.value,\r\n          hasProvince && \"shipping_address[province]=\" + provinceField.value,\r\n          \"shipping_address[zip]=\" + zipField.value,\r\n        ]\r\n          .filter(Boolean)\r\n          .join(\"&\")}`,\r\n        { dataType: \"json\" },\r\n      )\r\n        .then((data) => {\r\n          let { length } = data.shipping_rates;\r\n          shippingResultsTitle.innerHTML = \"\";\r\n          if (length === 0) {\r\n            shippingResultsTitle.innerHTML = theme.strings.shipping.notResult;\r\n          } else if (length === 1) {\r\n            shippingResultsTitle.innerHTML = theme.strings.shipping.oneResult.replace(\r\n              \"{{address}}\",\r\n              [zipField.value, provinceField.value, countryField.value].filter(Boolean).join(\", \"),\r\n            );\r\n          } else {\r\n            shippingResultsTitle.innerHTML = theme.strings.shipping.manyResults\r\n              .replace(\r\n                \"{{address}}\",\r\n                [zipField.value, provinceField.value, countryField.value].filter(Boolean).join(\", \"),\r\n              )\r\n              .replace(\"{{results_total}}\", data.shipping_rates.length)\r\n              .replace(\r\n                \"{{rate_first}}\",\r\n                `<span class=\"js-money\">${(data.shipping_rates[0].price * 100).toCurrency()}</span>`,\r\n              );\r\n          }\r\n          shippingResultsList.innerHTML = \"\";\r\n          if (length != 0) {\r\n            shippingResultsList.innerHTML = data.shipping_rates\r\n              .map((item) => {\r\n                let li = document.createElement(\"li\");\r\n                li.innerHTML = theme.strings.shipping.resultItem\r\n                  .replace(\"{{name}}\", item.name)\r\n                  .replace(\"{{price}}\", `<span class=\"js-money\">${(item.price * 100).toCurrency()}</span>`);\r\n                return li.outerHTML;\r\n              })\r\n              .join(\"\");\r\n          }\r\n\r\n          if (typeof Currencies !== \"undefined\") {\r\n            shippingResultsList.getElementsByClassName(\"js-money\").forEach(Currencies.registerObserve.bind(Currencies));\r\n          }\r\n          shippingResults.style.height = shippingResults.firstElementChild.offsetHeight + \"px\";\r\n        })\r\n        .catch((data) => {\r\n          console.log(data);\r\n          shippingResultsTitle.innerHTML = \"\";\r\n          shippingResultsList.innerHTML = Object.keys(data).map((key) => {\r\n            return `<li>${key}: ${data[key]}</li>`;\r\n          });\r\n          shippingResults.style.height = shippingResults.firstElementChild.offsetHeight + \"px\";\r\n        });\r\n    });\r\n  },\r\n\r\n  updateItemTotalMoney(element, totalPrice) {\r\n    if (typeof Currencies === \"undefined\") {\r\n      element.innerHTML = totalPrice.toCurrency();\r\n    } else {\r\n      element.setAttribute(\"data-money\", totalPrice);\r\n    }\r\n  },\r\n\r\n  updateTotalMoney(totalPrice) {\r\n    let { cartTotalMoney } = this.elms;\r\n\r\n    if (typeof Currencies === \"undefined\") {\r\n      cartTotalMoney.innerHTML = totalPrice.toCurrency();\r\n    } else {\r\n      cartTotalMoney.setAttribute(\"data-money\", totalPrice);\r\n    }\r\n  },\r\n};\r\n", "import { CartPage } from \"./common/section\";\r\n\r\n(() => {\r\n  register(\"cart-page\", CartPage);\r\n  load(\"*\");\r\n})();\r\n"],
  "mappings": "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",
  "names": []
}
