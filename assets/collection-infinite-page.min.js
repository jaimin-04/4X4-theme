(()=>{var m=function(){let e=document.getElementById("grid_style_list");if(!e)return;let{container:r}=this,i=[...r.classList].join(" "),{productGridContainer:o}=this.elms;e.children.forEach(t=>{let n=t.dataset.class,s=t.dataset.style;t.addEvent("click",()=>{o.className=n,r.className=`${i} ${s}`})})};function p(){let{sidebarContainer:e}=this.elms;if(!e)return;let r=e.querySelectorAll(".featured_block-filter_group");e&&r.forEach(i=>{let o=i.dataset.multiple==="true",t=i.querySelector(".filter-clear"),n=i.querySelectorAll(".tags-link"),s;n.forEach(c=>{let u=c.dataset.tagValue;c.addEvent("click",l=>{l.preventDefault(),c.hasClass("active")?(this.currentTags=this.currentTags.filter(a=>a!=u),s="remove"):(o||[...n].filter(a=>a.hasClass("active")).forEach(a=>(a.removeClass("active"),this.currentTags=this.currentTags.filter(h=>h!=a.dataset.tagValue))),this.currentTags.push(u),s="add"),t.addClass("pending"),t.removeClass("d-none"),this.getProductList(this.getUrlAjaxRequest(null,"filter")).then(()=>{switch(s){case"add":c.addClass("active");break;case"remove":c.removeClass("active"),[...n].find(a=>a.hasClass("active"))||t.addClass("d-none");break}t.removeClass("pending"),d()})})}),t.addEvent("click",c=>{c.preventDefault();let u=[...n].map(l=>l.hasClass("active")&&l.dataset.tagValue).filter(Boolean);this.currentTags=this.currentTags.filter(l=>!u.includes(l)),t.addClass("pending"),this.getProductList(this.getUrlAjaxRequest(null,"filter")).then(()=>{t.addClass("d-none"),t.removeClass("pending"),n.forEach(l=>l.removeClass("active")),d()})});function d(){theme.settings.collection.scrollTopWhenFilter&&AT.scrollTo(document.getElementById("main-layout").offsetTop-100)}})}var f={onLoad:function(){let{container:e}=this;Object.assign(this,theme.collection),!this.currentTags&&(this.currentTags=[]),this.elms={sortContainer:e.querySelector(".js-collection-sort-container"),selectDesk:document.getElementById("select_desk"),selectDeskTitle:document.getElementById("select_desk_title"),selectDeskContainer:document.getElementById("select_desk_container"),productItems:[...e.getElementsByClassName("product-section")],infiniteBtn:e.querySelector(".js-infinite-btn"),productGridContainer:e.querySelector("#product-grid-container"),sidebarContainer:e.querySelector("#sidebarDrawer"),toggleSbButton:e.getElementsByClassName("js-toggle-sb"),infiniteButton:e.querySelector(".js-infinite-btn"),filterContainer:document.querySelector(".js-filter-container")},this.initSortCollection(),this.initCollapse(),p.call(this),this.initToggleSidebar(),this.initFilter(),this.initInfinite(),m.call(this)},initFilter(){let{filterContainer:e}=this.elms;!e||(typeof Filter!="undefined"?new Filter(e):AT.loadCollectionFilter().then(()=>{new Filter(e)}))},initSortCollection:function(){let{sortContainer:e}=this.elms,r=e.querySelector("#select_desk_container"),i=e.querySelector("#select_desk"),o=r.querySelector("#select_desk_title"),n=e.querySelector("#mobile-select-container").firstElementChild;r.addEvent("click",function(){this.hasClass("is-open")?this.removeClass("is-open"):this.addClass("is-open")}),document.addEvent("click",s=>{r.contains(s.target)||r.removeClass("is-open")}),i.children.addEvents("click",function(){let s=this.innerHTML,d=this.dataset.value;o.innerHTML=s,n.value=d,n.dispatchEvent(new Event("change"))}),n.addEvent("change",s=>{let{value:d}=s.target;this.getProductList(this.getUrlAjaxRequest(d,"sort-by"))})},getUrlAjaxRequest:function(e,r){let i="",o;switch(window.location.href.includes("vendors")&&(o=AT.getParameterByName("q")),r){case"sort-by":{if(o){let t=[...window.location.search.replace("?","").split("&").filter(n=>!n.includes("sort_by")),`sort_by=${e}`,"view=ajax-request"];i=`${window.location.pathname}?${t.join("&")}`}else if(window.location.search)if(location.search.includes("sort_by")){let t=location.search.split("&");t=t.map(n=>n.includes("sort_by")?n.split("=")[0]+"="+e:n),t.push("view=ajax-request"),i=`${location.origin}${location.pathname}${t.join("&")}`}else i=`${location.href}&sort_by=${e}&view=ajax-request`;else i=`${location.href}?sort_by=${e}&view=ajax-request`;break}case"filter":{if(o){let t=[this.currentTags.length?`constraint=${encodeURIComponent(this.currentTags.join("+"))}`:"",...window.location.search.replace("?","").split("&").filter(n=>!n.includes("constraint")&&!n.includes("page")),"view=ajax-request"].filter(Boolean).join("&");i=`${window.location.pathname}?${t}`}else if(location.search){let t=location.search.split("&");t=t.map(n=>n.includes("page=")&&+n.split("=")[1]>1?n.split("=")[0]+"=1":n),i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${t.join("&")}&view=ajax-request`,console.log(121233)}else console.log(123),i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}default:window.location.search?i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${window.location.search}&view=ajax-request`:i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}return i},getProductList:function(e){let{productGridContainer:r,infiniteButton:i}=this.elms;return fetch(e,{dataType:"text"}).then(o=>{let t=document.createElement("div");t.innerHTML=o;let n=t.querySelectorAll(".js-product-card");n.length?(r.innerHTML="",n.forEach(s=>{ProductCard.initEvent(s),r.append(s)})):r.innerHTML=`<p class="text-center">${this.notFound}</p>`,history.replaceState({},"",e.replace("?view=ajax-request&","?").replace("?view=ajax-request","").replace("&view=ajax-request","")),typeof window.SPR!="undefined"&&(window.SPR.initDomEls(),window.SPR.loadBadges(),window.SPR.loadProducts()),document.title=t.querySelector(".page-title").textContent,i.setAttribute("data-page",1),i.removeClass("end")})},initCollapse:function(){this.container.getElementsByClassName("js-btn-collapse").addEvents("click",function(){this.hasClass("is-open")?(this.removeClass("is-open"),this.nextElementSibling.removeClass("is-open")):(this.addClass("is-open"),this.nextElementSibling.addClass("is-open"))})},initToggleSidebar:function(){let{toggleSbButton:e,sidebarContainer:r}=this.elms;!r||e.forEach(i=>{i.addEvent("click",function(){let{role:o}=i.dataset;switch(o){case"open":r.addClass("is-open");break;case"close":r.removeClass("is-open");break}})})},initInfinite:function(){let{infiniteButton:e,productGridContainer:r}=this.elms,i=!1,o=()=>{if(i||e.hasClass("end"))return;let t=e.getBoundingClientRect();if(500>t.top-window.innerHeight){let s=+e.dataset.page+1,d=this.getUrlAjaxRequest()+`&page=${s}`;i=!0,e.addClass("pending"),fetch(d,{dataType:"text"}).then(c=>{let u=document.createElement("div");u.innerHTML=c;let l=u.querySelectorAll(".js-product-card"),a=u.querySelector(".last-page");l.length&&(l.forEach(h=>{ProductCard.initEvent(h),r.append(h)}),e.setAttribute("data-page",s)),i=!1,e.removeClass("pending"),a&&e.addClass("end"),typeof window.SPR!="undefined"&&(window.SPR.initDomEls(),window.SPR.loadBadges(),window.SPR.loadProducts())})}};window.removeEvent("scroll",o),window.addEvent("scroll",o)}};(()=>{register("collection-infinite",f),load("*"),console.log("collection-infinite-page.js loaded")})();})();
