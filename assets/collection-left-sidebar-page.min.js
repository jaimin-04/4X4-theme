(()=>{var h=function(){let e=document.getElementById("grid_style_list");if(!e)return;let{container:r}=this,i=[...r.classList].join(" "),{productGridContainer:o}=this.elms;e.children.forEach(n=>{let t=n.dataset.class,s=n.dataset.style;n.addEvent("click",()=>{o.className=t,r.className=`${i} ${s}`})})};function m(){let{sidebarContainer:e}=this.elms;if(!e)return;let r=e.querySelectorAll(".featured_block-filter_group");e&&r.forEach(i=>{let o=i.dataset.multiple==="true",n=i.querySelector(".filter-clear"),t=i.querySelectorAll(".tags-link"),s;t.forEach(l=>{let u=l.dataset.tagValue;l.addEvent("click",c=>{c.preventDefault(),l.hasClass("active")?(this.currentTags=this.currentTags.filter(d=>d!=u),s="remove"):(o||[...t].filter(d=>d.hasClass("active")).forEach(d=>(d.removeClass("active"),this.currentTags=this.currentTags.filter(y=>y!=d.dataset.tagValue))),this.currentTags.push(u),s="add"),n.addClass("pending"),n.removeClass("d-none"),this.getProductList(this.getUrlAjaxRequest(null,"filter")).then(()=>{switch(s){case"add":l.addClass("active");break;case"remove":l.removeClass("active"),[...t].find(d=>d.hasClass("active"))||n.addClass("d-none");break}n.removeClass("pending"),a()})})}),n.addEvent("click",l=>{l.preventDefault();let u=[...t].map(c=>c.hasClass("active")&&c.dataset.tagValue).filter(Boolean);this.currentTags=this.currentTags.filter(c=>!u.includes(c)),n.addClass("pending"),this.getProductList(this.getUrlAjaxRequest(null,"filter")).then(()=>{n.addClass("d-none"),n.removeClass("pending"),t.forEach(c=>c.removeClass("active")),a()})});function a(){theme.settings.collection.scrollTopWhenFilter&&AT.scrollTo(document.getElementById("main-layout").offsetTop-100)}})}var p={onLoad:function(){let{container:e}=this;Object.assign(this,theme.collection),!this.currentTags&&(this.currentTags=[]),this.elms={sortContainer:e.querySelector(".js-collection-sort-container"),selectDesk:document.getElementById("select_desk"),selectDeskTitle:document.getElementById("select_desk_title"),selectDeskContainer:document.getElementById("select_desk_container"),productItems:[...e.getElementsByClassName("product-section")],infiniteBtn:e.querySelector(".js-infinite-btn"),productGridContainer:e.querySelector("#product-grid-container"),collectionPaginationContainer:e.querySelector(".js-colletion-pagination-container"),paginationShowing:e.querySelector(".js-pagination-showing"),sidebarContainer:e.querySelector("#sidebarDrawer"),toggleSbButton:e.getElementsByClassName("js-toggle-sb"),filterContainer:document.querySelector(".js-filter-container")},this.initSortCollection(),this.initCollapse(),this.getProductList(this.getUrlAjaxRequest()),m.call(this),this.initToggleSidebar(),this.initFilter(),h.call(this)},initFilter(){let{filterContainer:e}=this.elms;!e||(typeof Filter!="undefined"?new Filter(e):AT.loadCollectionFilter().then(()=>{new Filter(e)}))},initSortCollection:function(){let{sortContainer:e}=this.elms,r=e.querySelector("#select_desk_container"),i=e.querySelector("#select_desk"),o=r.querySelector("#select_desk_title"),t=e.querySelector("#mobile-select-container").firstElementChild;r.addEvent("click",function(){this.hasClass("is-open")?this.removeClass("is-open"):this.addClass("is-open")}),document.addEvent("click",s=>{r.contains(s.target)||r.removeClass("is-open")}),i.children.addEvents("click",function(){let s=this.innerHTML,a=this.dataset.value;o.innerHTML=s,t.value=a,t.dispatchEvent(new Event("change"))}),t.addEvent("change",s=>{let{value:a}=s.target;this.getProductList(this.getUrlAjaxRequest(a,"sort-by"))})},getUrlAjaxRequest:function(e,r){let i="",o;switch(window.location.href.includes("vendors")&&(o=AT.getParameterByName("q")),r){case"sort-by":{if(o){let n=[...window.location.search.replace("?","").split("&").filter(t=>!t.includes("sort_by")),`sort_by=${e}`,"view=ajax-request"];i=`${window.location.pathname}?${n.join("&")}`}else if(window.location.search)if(location.search.includes("sort_by")){let n=location.search.split("&");n=n.map(t=>t.includes("sort_by")?t.split("=")[0]+"="+e:t),n.push("view=ajax-request"),i=`${location.origin}${location.pathname}${n.join("&")}`}else i=`${location.href}&sort_by=${e}&view=ajax-request`;else i=`${location.href}?sort_by=${e}&view=ajax-request`;break}case"filter":{if(o){let n=[this.currentTags.length?`constraint=${encodeURIComponent(this.currentTags.join("+"))}`:"",...window.location.search.replace("?","").split("&").filter(t=>!t.includes("constraint")&&!t.includes("page")),"view=ajax-request"].filter(Boolean).join("&");i=`${window.location.pathname}?${n}`}else if(location.search){let n=location.search.split("&");n=n.map(t=>t.includes("page=")&&+t.split("=")[1]>1?t.split("=")[0]+"=1":t),i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${n.join("&")}&view=ajax-request`}else i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}default:window.location.search?i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${window.location.search}&view=ajax-request`:i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}return i},getProductList:function(e){let{productGridContainer:r,collectionPaginationContainer:i,paginationShowing:o}=this.elms;return fetch(e,{dataType:"text"}).then(n=>{let t=document.createElement("div");t.innerHTML=n;let s=t.querySelectorAll(".js-product-card"),a=t.querySelector(".collection-pagination");o.innerHTML=t.querySelector(".pagination-showing").innerHTML,s.length?(r.innerHTML="",s.forEach(l=>{ProductCard.initEvent(l),r.append(l)})):r.innerHTML=`<p class="text-center">${this.notFound}</p>`,i.innerHTML=a.innerHTML||"",i.querySelectorAll("a").forEach(l=>{l.href=AT.removeParam("view",l.href)}),history.replaceState({},"",e.replace("?view=ajax-request&","?").replace("?view=ajax-request","").replace("&view=ajax-request","")),document.title=t.querySelector(".page-title").textContent,typeof window.SPR!="undefined"&&(window.SPR.initDomEls(),window.SPR.loadBadges(),window.SPR.loadProducts())})},initCollapse:function(){this.container.getElementsByClassName("js-btn-collapse").addEvents("click",function(){this.hasClass("is-open")?(this.removeClass("is-open"),this.nextElementSibling.removeClass("is-open")):(this.addClass("is-open"),this.nextElementSibling.addClass("is-open"))})},initToggleSidebar:function(){let{toggleSbButton:e,sidebarContainer:r}=this.elms;!r||e.forEach(i=>{i.addEvent("click",function(){let{role:o}=i.dataset;switch(o){case"open":r.addClass("is-open");break;case"close":r.removeClass("is-open");break}})})}};(()=>{register("collection-left-sidebar",p),load("*"),console.log("collection-left-siddebar-page.js loaded")})();})();
