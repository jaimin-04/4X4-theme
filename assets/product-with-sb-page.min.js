(()=>{var S=(e,n,l)=>{let i={};if(!e)return;let u=e.dataset.status,a=e.getElementsByClassName("js-option-item");if(n.variants.length<=1)return;a.addEvents("change",function(){e.dispatchEvent(new CustomEvent("swatch-change",{detail:+this.dataset.optionPosition}))}),e.addEvent("swatch-change",function({detail:t}){switch(t){case 1:n.options.length>1?h(2):l(o(p()));break;case 2:n.options.length===3?n.options.length===3&&h(3):l(o(p()));break;case 3:l(o(p()));break}}),n.variants.forEach(t=>{if(t.available){if(i.root=i.root||[],i.root.push(t.option1),i.root=i.root.reduce((c,s)=>(c.includes(s)||c.push(s),c),[]),n.options.length>1){var r=t.option1;i[r]=i[r]||[],i[r].push(t.option2),i[r]=i[r].reduce((c,s)=>(c.includes(s)||c.push(s),c),[])}if(n.options.length===3){var r=t.option1+" / "+t.option2;i[r]=i[r]||[],i[r].push(t.option3),i[r]=i[r].reduce((s,m)=>(s.includes(m)||s.push(m),s),[])}}}),h(1);function h(t){let r=!1,c=p(),s,m,v;switch(t){case 1:s="root",m=e.querySelector(".js-swatch-item[data-position='1']");break;case 2:s=c.option1,m=e.querySelector(".js-swatch-item[data-position='2']");break;case 3:s=c.option1+" / "+c.option2,m=e.querySelector(".js-swatch-item[data-position='3']");break}switch(m.dataset.style){case"select":{let d=m.getElementsByClassName("js-option-item")[0],g=d.value;switch(u){case"hide":{d.innerHTML=i[s].map(C=>`<option value="${C}">${C}</option>`).join(""),i[s].includes(g)&&(d.value=g);break}case"disable":{[...d.options].forEach(C=>{i[s].includes(C.value)?C.disabled=!1:(C.disabled=!0,C.value===g&&(C.selected=!1))});break}}break}case"color":case"button":let f=m.getElementsByClassName("js-option-item"),y=[...f].find(d=>d.checked).value;switch(u){case"hide":f.forEach(d=>{i[s].includes(d.value)?d.parentElement.removeClass("d-none"):(d.parentElement.addClass("d-none"),y===d.value&&(d.checked=!1,f[0].checked=!0))});break;case"disable":{f.forEach(d=>{i[s].includes(d.value)?d.disabled=!1:(d.disabled=!0,y===d.value&&(d.checked=!1,f[0].checked=!0))});break}}break}e.dispatchEvent(new CustomEvent("swatch-change",{detail:t}))}function p(){return[...e.getElementsByClassName("js-swatch-item")].reduce((t,r)=>{switch(r.dataset.style){case"select":let c=r.querySelector("select.single-option-selector");t[c.name]=c.value;break;case"color":case"image":case"button":let s=r.querySelectorAll("input[data-single-option-selector]");t[s[0].name]=[...s].find(m=>m.checked).value;break}return t},{})}function o(t){return n.variants.find(r=>Object.keys(t).every(c=>r[c]===t[c]))}};var w=()=>{let e=theme.product.handle,n=AT.cookie.get("recently-viewed-products")||[];n.length?(!n.includes(e)&&n.unshift(e),n.length=10):n.unshift(e),AT.cookie.set("recently-viewed-products",n.filter(Boolean),7)};function b(e){var n=a=>{let h=[],p;return a.querySelectorAll(".media-item").forEach(o=>{let t=o.querySelector("img");!t||(p={src:o.dataset.imgUrl,w:+t.getAttribute("width"),h:+t.getAttribute("height"),el:t},p.o={src:p.src,w:+t.getAttribute("width"),h:+t.getAttribute("height")},h.push(p))}),h},l=(a,h)=>a&&(h(a)?a:l(a.parentNode,h)),i=a=>{a.preventDefault();var h=a.target||a.srcElement,p=l(h,o=>o.hasClass("media-item"));if(!!p)return u(p.dataset.position-1),!1},u=(a,h,p)=>{var o=document.getElementById("modal-image-zoom"),t,r,c;if(c=n(e),r={galleryUID:e.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(d){var g=c[d].el,C=window.pageYOffset||document.documentElement.scrollTop,E=g.getBoundingClientRect();return{x:E.left,y:E.top+C,w:E.width}}},p)if(r.galleryPIDs){for(var s=0;s<c.length;s++)if(c[s].pid==a){r.index=s;break}}else r.index=parseInt(a,10)-1;else r.index=parseInt(a,10);if(!isNaN(r.index)){h&&(r.showAnimationDuration=0),t=new PhotoSwipe(o,PhotoSwipeUI_Default,c,r);var m,v=!1,f=!0,y;t.listen("beforeResize",function(){var d=window.devicePixelRatio?window.devicePixelRatio:1;d=Math.min(d,2.5),m=t.viewportSize.x*d,m>=1200||!t.likelyTouchDevice&&m>800||screen.width>1200?v||(v=!0,y=!0):v&&(v=!1,y=!0),y&&!f&&t.invalidateCurrItems(),f&&(f=!1),y=!1}),t.listen("afterChange",()=>{!!this.mainSlider&&typeof this.mainSlider.goTo=="function"&&this.mainSlider.goTo(t.getCurrentIndex())}),t.listen("gettingData",function(d,g){g.src=g.o.src,g.w=g.o.w,g.h=g.o.h}),t.init()}};e.querySelectorAll("img").forEach(a=>{let h=!1,p=!1;a.addEvent("mousedown",()=>{p=!0}),a.addEvent("mouseup",o=>{h||i(o),p=!1,h=!1}),a.addEvent("mousemove",o=>{p&&(h=!0)})}),e.setAttribute("data-pswp-uid",1)}var q={onLoad:function(){let e=this.container;this.product=theme.product,this.elms={priceCompareElement:e.querySelector(".js-compare-at-price"),priceElement:e.querySelector(".js-product-price"),variantAvailableStatus:e.querySelector(".js-product-status"),skuElement:e.querySelector(".js-product-sku"),mainMediaContainer:document.querySelector(".js-slider-main"),thumbnailsMediaContainer:document.querySelector(".js-slider-thumbnails"),tabPanelElement:e.querySelector(".js-tab-panel"),selectMaster:e.querySelector("#selected_variant"),inputQuantityContainer:e.querySelector(".js-input-quantity-container"),formElm:e.querySelector(".js-form-add-to-card"),buttonAddToCart:document.querySelector(".btn-add-to-cart"),swatchFormContainer:e.querySelector(".js-swatch-form"),openSbBtn:document.getElementById("js_open_sidebar"),closeSbBtn:document.getElementById("js_close_sidebar"),sbContainer:document.getElementById("sidebarDrawer"),recentlyViewContainer:document.getElementById("product_sb_recently_view")},this.initSlideMedia(),AT.initInputQuantity(this.elms.inputQuantityContainer),AT.initTabPanel(this.elms.tabPanelElement),S(this.elms.swatchFormContainer,this.product,this.handleVariantChange.bind(this)),!!this.elms.formElm&&AT.initFormAddToCart(this.elms.formElm),this.initToggleSb(),!!this.elms.mainMediaContainer&&b.call(this,this.elms.mainMediaContainer)},initSlideMedia:function(){let{mainMediaContainer:e,thumbnailsMediaContainer:n}=this.elms;(()=>{if(!e)return;let l=e.querySelector("[data-tns-config]");if(!l)return;let i=JSON.parse(l.innerHTML);this.mainSlider=tns(i),this.mainSlider.events.on("indexChanged",u=>{u.slideItems.forEach(a=>{a.querySelector("video")&&a.querySelector("video").pause()}),u.slideItems[u.index].querySelector("video")&&u.slideItems[u.index].querySelector("video").play()})})(),(()=>{if(!n)return;let l=JSON.parse(n.querySelector("[data-tns-config]").innerHTML);this.sliderThumbnail=tns(l)})()},initToggleSb:function(){let{openSbBtn:e,closeSbBtn:n,sbContainer:l}=this.elms;e.addEventListener("click",()=>{l.classList.add("is-open")}),n.addEventListener("click",()=>{l.classList.remove("is-open")})},handleVariantChange:function(e){let{priceCompareElement:n,priceElement:l,variantAvailableStatus:i,skuElement:u,buttonAddToCart:a,selectMaster:h}=this.elms;if(!e){a.disabled=!0,i.setAttribute("data-status","0");return}typeof Currencies!="undefined"?(e.compare_at_price?(n.setAttribute("data-money",e.compare_at_price),n.removeClass("d-none")):n.addClass("d-none"),l.setAttribute("data-money",e.price)):(e.compare_at_price?(n.innerHTML=e.compare_at_price.toCurrency(),n.removeClass("d-none")):n.addClass("d-none"),l.innerHTML=e.price.toCurrency()),e.available?(a.disabled=!1,i.setAttribute("data-status","1")):(a.disabled=!0,i.setAttribute("data-status","0")),i.setAttribute("data-status",e.available?1:0),u&&(e.sku?(u.innerHTML=e.sku,u.parentElement.removeClass("d-none")):u.parentElement.addClass("d-none")),!!e.featured_image&&!!this.mainSlider&&this.mainSlider.goTo(e.featured_image.position-1),h.value=e.id}};var j={onLoad:function(){let{container:e}=this,n=e.querySelector(".js-slider-container"),l=JSON.parse(n.querySelector("[data-tns-config]").innerHTML);l.onInit=()=>{n.addClass("slider-initialized")},tns(l)}};var k={onLoad:async function(){this.container.getElementsByClassName("js-btn-collapse").forEach(o=>{let t=document.getElementById(o.dataset.target);o.addEvent("click",()=>{o.hasClass("is-open")?(t.removeClass("is-open"),o.removeClass("is-open")):(t.addClass("is-open"),o.addClass("is-open"))})});let n=this.container.querySelector(".js-sb-recently-viewed");if(!n)return;let l=document.getElementById("product_sb_review_template").firstElementChild,i=document.getElementById("product_sb_recently_view"),u=+n.dataset.limit,a=AT.cookie.get("recently-viewed-products")||[];a.length=u;let h=a.filter(Boolean).map(o=>!!o&&fetch(`/products/${o.trim()}.js`,{dataType:"json"}));(await Promise.all(h)).map(o=>{let t=l.cloneNode(!0),r=o.variants.find(y=>y.available)||o.variants[0],c=t.querySelector(".js-save-percent"),s=t.querySelector(".js-compare-at-price"),m=r.compare_at_price,v=t.querySelector(".js-price"),f=r.price;theme.settings.currencies.enable&&(s.addClass("js-money"),v.addClass("js-money")),v.innerHTML=r.price.toCurrency(),!!m&&m>f?(c.innerHTML=Math.round((m-f)/m*100)+"%",c.removeClass("d-none"),s.innerHTML=m.toCurrency(),s.removeClass("d-none")):s.remove(),typeof Currencies!="undefined"&&(Currencies.registerObserve(v),m&&Currencies.registerObserve(s)),t.querySelector(".js-img").src=r.featured_image?r.featured_image.src:o.featured_image,t.querySelector(".js-name").innerHTML=o.title,t.querySelectorAll(".js-url").forEach(y=>y.href=o.url),i.append(t)}),h.length&&n.closest(".featured_block-recently-view").removeClass("d-none")}};var x={onLoad(){AT.cookie.get("recently-viewed-products"),AT.cookie.get("recently-viewed-products")&&this.getListProducts(AT.cookie.get("recently-viewed-products"))},getListProducts(e){let n=e.filter(l=>l!=theme.product.handle);Promise.all(n.map(l=>fetch(`${theme.routes.searchUrl}?view=product-card&q=${l}`,{dataType:"text"}).then(i=>{let u=document.createElement("div");return u.addClass("slider-item"),u.innerHTML=i,ProductCard.initEvent(u),u}))).then(l=>{let i=l.filter(Boolean);i.length&&(i.forEach(u=>{this.container.querySelector(".slider-list").append(u)}),this.container.removeClass("d-none"),this.initSlider())})},initSlider(){let e=JSON.parse(this.container.querySelector("[data-tns-config]").innerHTML),n=this.container.querySelector(".js-slider-container");e.onInit=()=>{n.addClass("slider-initialized")},tns(e)}};(()=>{theme.sectionRegister.forEach(e=>{switch(e){case"product-template":register(e,q);break;case"product-sidebar":register(e,k);break;case"related-product":register(e,j);break;case"recently-viewed":register(e,x);break}load("*")}),w(),console.log("product-with-sb-page.js loaded")})();})();
